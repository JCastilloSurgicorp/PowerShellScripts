SELECT FCRMVH_NROGUI, FCRMVH_DESDPT, FCRMVH_DEPTRA, FCRMVH_DEPOSI, FCRMVH_SECTOR, USR_FCTTMT_DESCRIP, FCRMVH_FECALT FROM [dbo].[USR_FCRMVH] 
SELECT TOP 6000 FCRMVH_VNDDOR, USR_UBFSEC_DESCRP, FCRMVH_DESSED, FCRMVH_DESJUR, * FROM [dbo].[USR_FCRMVH] 
WHERE FCRMVH_NROGUI = 'T001-24848' --or FCRMVH_NROFOR = '1034'
WHERE FCRMVH_ESTADO = 'ANU'
ORDER BY FCRMVH_FECALT desc

-- Salidas de Guias de Remisión
SELECT * FROM [dbo].[USR_SALGUI]
WHERE SALGUI_NROGUI = 'T001-51422'
ORDER BY SALGUI_FECALT desc

-- Anulaciones de Guias de Remisión
SELECT * FROM [dbo].[USR_ANUGUI]
WHERE ANUGUI_TIPREG = 'G'
and ANUGUI_NROGUI = 'T001-12292' --and ANUGUI_NROFOR = 76
ORDER BY ANUGUI_NROGUI desc
--INSERT INTO [USR_ANUGUI] ([ANUGUI_CODEMP], [ANUGUI_MODFOR], [ANUGUI_CODFOR], [ANUGUI_NROFOR], [ANUGUI_NROGUI], [ANUGUI_TIPREG], [ANUGUI_USERID], [ANUGUI_FECALT])
--VALUES ('01', 'ST', 'SGAGE1', 265, 'T001-48599', 'G', 'JROMERO', CONVERT(datetime,'2025-08-11 12:15:57.433'));
--DELETE FROM [USR_ANUGUI]
--WHERE ANUGUI_NROGUI = 'T001-12292' and ANUGUI_NROFOR = 76
--tablas varias
SELECT * FROM [dbo].GR_BUSQUEDA
SELECT * FROM [dbo].[FEEDBACK]
SELECT* FROM [dbo].[auth_user]
SELECT* FROM [dbo].[auth_group]
SELECT* FROM [dbo].[auth_user_groups]
SELECT* FROM [dbo].[auth_group_permissions]
SELECT* FROM [dbo].[auth_permission]
SELECT* FROM [dbo].[django_content_type]
SELECT * FROM [dbo].[extended_users]
SELECT * FROM [dbo].[extended_users_groups]
SELECT * FROM [dbo].[extended_users_user_permissions]
SELECT * FROM [dbo].[django_admin_log]
SELECT* FROM [dbo].[django_session]
SELECT * FROM [dbo].[USR_VALCON]
SELECT * FROM [dbo].[USR_VTRMVH]
SELECT * FROM [dbo].[SI_Empresa]
SELECT * FROM [sys].[traces]
SELECT * FROM [dbo].[HP_SCAN_PRODUCTOS]
SELECT * FROM [dbo].[EU_Puestos]
SELECT * FROM [dbo].[USR_PARINT]
--WHERE DESCRIPCION_PRODUCTO_HP = 'Error al buscar producto'
ORDER BY id desc
SELECT * FROM sys.messages 
WHERE severity >= 16 and language_id = 3082
ORDER BY message_id desc

-- Consultas a la cabecera de las Guias de Remision
SELECT * FROM [dbo].GUIAS_REMISION 
--WHERE NUMERO_GUIA = 'T001-34746'  --37725
LEFT JOIN [USR_ANUGUI] ON ANUGUI_NROGUI = NUMERO_GUIA and ANUGUI_CODEMP = EMPRESA_ID and ANUGUI_TIPREG = 'G'
WHERE id < 57000 
ORDER BY id desc

--UPDATE GUIAS_REMISION
--	SET ESTADO = 'ANU'
--FROM [USR_ANUGUI]
--WHERE id < 57000 and ANUGUI_NROGUI = NUMERO_GUIA and ANUGUI_CODEMP = EMPRESA_ID and ANUGUI_TIPREG = 'G'

SELECT NUMERO_GUIA, COUNT(NUMERO_GUIA) AS cantidad 
FROM GUIAS_REMISION 
GROUP BY NUMERO_GUIA

-- Consultas GR_Audit
SELECT * FROM [dbo].[GR_UPDATE_AUDIT]
WHERE NUMERO_ITEM = -1
--WHERE NUMERO_GUIA = 'T003-23397'
ORDER BY id desc

-- Consultas GR_REGULARIZACION
SELECT * FROM [dbo].[GR_REGULARIZACION]
--WHERE NUMERO_GUIA = 'T003-23397'
ORDER BY id desc

-- consultas a HOJA_PICKING
SELECT * FROM [dbo].HOJA_PICKING 
--WHERE NUMERO_GUIA = 'T001-17062'
--WHERE APP_SESSION_ACTIVE is not null
ORDER BY PICKING_TIME desc
--CREATE INDEX HP_nroGuia ON [dbo].[HOJA_PICKING] (NUMERO_GUIA);
--UPDATE HOJA_PICKING
--	--SET USUARIO = 'Jairo Castillo'
--	--SET USUARIO = 'Creado por Servidor'
--	SET LIMA_PROVINCIA = 1
--WHERE NUMERO_GUIA = 'T001-17062'

-- Consultas a HP_AUDIT
SELECT * FROM [dbo].[HP_UPDATE_AUDIT] 
WHERE ESTADO_NEW = 'DELETED'
--WHERE NUMERO_GUIA = 'T003-850' --t001-46938
ORDER BY id desc

-- Consultas a Lista_Blanca
SELECT * FROM [dbo].[HP_LISTA_BLANCA]
--UPDATE HP_LISTA_BLANCA
--SET DESCRIPCION_PRODUCTO_HP = 'ROD PRE-CURV 5.5 X 40 MM'
--WHERE PRODUCTO = 'MB1RL5540'
SELECT PRODUCTO, COUNT(*) as Cantidad 
FROM dbo.HP_LISTA_BLANCA
GROUP BY producto
--HAVING COUNT(*) > 1;
SET STATISTICS TIME ON

-- Consultas a Guias Digemid
SELECT * FROM GUIA_DIGEMID
WHERE CONDUCTOR is null
ORDER BY id desc

-- Consultas a Descripcion Digemid
SELECT * FROM [dbo].[GD_DESCRIPCION]
ORDER BY id desc

--UPDATE GUIAS_REMISION
--	SET CODIGO_REPRESENTANTE = TRIM((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 1)),
--		OC_CLIENTE = TRIM((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 2)),
--		NRO_PROCESO = TRIM((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 3)),
--		PESO_TOTAL = CAST((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 4) as INT),
--		OBSERVACION = TRIM(IIF((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 5) = ' Anulado por Servidor ', (SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 6), (SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 5))),
--		PACIENTE = TRIM(IIF((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 5) = ' Anulado por Servidor ', (SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 7), (SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 6))),
--		FECHA_CIRUGIA = IIF((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 5) = ' Anulado por Servidor ', SUBSTRING((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 8), 2, 19), SUBSTRING((SELECT value FROM STRING_SPLIT(i.ESTADO_OLD, '|', 1) WHERE ordinal = 7), 2, 19))
--FROM (
--	SELECT * FROM [GR_UPDATE_AUDIT]
--	WHERE ESTADO_NEW = 'R103 | ---- | ---- | 1 | ID# 19161 // PED# 86443 // | JOSE CARLOS LEONARDO RODRIGUEZ ANDRADE | 2025-07-12 09:00:00.'
--	ORDER BY [GR_UPDATE_AUDIT].ID_CONCAT desc
--) as i
--WHERE GUIAS_REMISION.NUMERO_GUIA = i.NUMERO_GUIA and
--	GUIAS_REMISION.EMPRESA_ID = i.EMPRESA_ID

--INSERT INTO [dbo].[SI_Empresa](EMPRESA) VALUES('RR MEDICAL S.R.L.')
--DELETE FROM [GUIA_DIGEMID] WHERE id > 463229 GUIA_DIGEMID
--DBCC CHECKIDENT('GUIA_DIGEMID', RESEED, 0)

/*UPDATE dbo.HOJA_PICKING
	SET GR_ID = i.id
	FROM GUIAS_REMISION AS i
	WHERE HOJA_PICKING.NUMERO_GUIA = i.NUMERO_GUIA AND
		HOJA_PICKING.EMPRESA_ID = i.EMPRESA_ID*/
--UPDATE dbo.HOJA_PICKING
--	SET SALIDA = 0,
--		USUARIO = 'Modificado por Servidor'
--	WHERE SALIDA is null -- and STATUS_PICKING = 'Picking Terminado'

--UPDATE GUIAS_REMISION
----SET FECHA_CIRUGIA = TRY_PARSE(CONCAT(CONVERT(date, USR_FCRMVH_FCHCIR), 
----		' ', 
----		STUFF(COALESCE(NULLIF(USR_FCRMVH_HORCIR, ''), '1200'), 3, 0, ':'), 
----		' ', 
----		IIF(USR_FCRMVH_TIPHOR = 'P', 'PM', 'AM')
----	) as datetime using 'en-us'
----)
--SET SEDE = ISNULL(i.FCRMVH_DESSED, '')
--FROM [USR_FCRMVH] as i
--WHERE NUMERO_GUIA = i.FCRMVH_NROGUI and EMPRESA_ID = i.FCRMVH_CODEMP

--UPDATE GUIAS_REMISION
--	SET SALIDA = i.SALIDA
--FROM HOJA_PICKING as i
--WHERE GUIAS_REMISION.NUMERO_GUIA = i.NUMERO_GUIA and GUIAS_REMISION.EMPRESA_ID = i.EMPRESA_ID

--SELECT USER_NAME();
--EXEC sp_who2; 
--SELECT SESSION_USER usuario_BD_sesion, 
--       CURRENT_USER usuario_BD_actual, 
--       SYSTEM_USER  usuario_sistema, 
--       ORIGINAL_LOGIN() login_usado_inicialmente, 
--       SUSER_SNAME() nombe_login_asociado_a_la_sesion;

--UPDATE GR_DESCRIPCION
--	SET REG_ID = g.id
--	FROM GR_REGULARIZACION as g 
--	WHERE GR_DESCRIPCION.NUMERO_GUIA = g.NUMERO_GUIA and
--		GR_DESCRIPCION.EMPRESA_ID = g.EMPRESA_ID

--UPDATE dbo.GUIAS_REMISION
--SET ATENCION = i.FCRMVH_USERID,
--	REPRESENTANTE =  i.VTTVND_DESCRP,
--	CODIGO_REPRESENTANTE = i.FCRMVH_VNDDOR,
--	MOTIVO_TRASLADO = i.USR_FCTTMT_DESCRIP,
--	NOMBRE_CLIENTE = i.VTMCLH_NOMBRE,
--	DIRECCION_ENTREGA = i.FCRMVH_DIRENT,
--	FECHA_GUIA = i.FCRMVH_FECALT,
--	ESTADO = i.FCRMVH_ESTADO,
--	ID_APP = i.USR_FCRMVH_NROAPP,
--	OBSERVACION = j.FCRMVH_TEXTOS,
--	OC_CLIENTE = i.USR_FCRMVH_OCCLIE,
--	NRO_PROCESO = i.USR_FCRMVH_NROPR,
--	TIPO_PEDIDO = IIF(i.USR_PRIOVT_DESPRI is null, 'Sin Tipo', i.USR_PRIOVT_DESPRI),
--	DOCTOR = i.FCRMVH_NOMMED,
--	PACIENTE = i.USR_FCRMVH_PACNOM, 
--	FECHA_CIRUGIA = TRY_PARSE(CONCAT(CONVERT(date, i.USR_FCRMVH_FCHCIR), 
--			' ', 
--			STUFF(COALESCE(ISNULL(i.USR_FCRMVH_HORCIR, '0000'), '1200'), 3, 0, ':'), 
--			' ', 
--			IIF(ISNULL(i.USR_FCRMVH_TIPHOR, 'A') = 'P', 'PM', 'AM')
--		) as datetime using 'en-us'
--	),
--	RUC_CLIENTE = i.FCRMVH_NROCTA,
--	DEPOSITO = i.FCRMVH_DEPOSI,
--	CODIGO_TRANSFERENCIA = ISNULL(i.FCRMVH_DEPTRA, i.FCRMVH_DEPOSI), 
--	TRANSFERENCIA = i.FCRMVH_DESDPT, 
--	CONDUCTOR = i.FCRMVH_NOMCOD, 
--	DNI_CONDUCTOR = i.FCRMVH_DOCCOD,
--	NUMERO_LICENCIA = i.FCRMVH_LICCOD, 
--	NUMERO_PLACA = i.FCRMVH_PLAVEH,
--	NUMERO_TARJETA_CIRCULACION = i.FCRMVH_TARUNI,
--	NUMERO_BULTOS = i.USR_FCRMVH_NROBUL,
--	PESO_TOTAL = i.USR_FCRMVH_PESKGM,
--	CODIGO_JURISDICCION = i.FCRMVH_JURISD,
--	JURISDICCION = i.FCRMVH_DESJUR,
--	SALIDA = IIF(i.FCRMVH_DEPOSI = 'CUS001', 1, 0),
--	INYECTADOS = IIF(i.FCRMVH_REQINY = 'S', 1, 0),
--	SEDE = ISNULL(i.FCRMVH_DESSED, ''),
--	USUARIO = 'Restaurado por Servidor'
--FROM [USR_FCRMVH] AS i
--	JOIN [USR_FCRMVH] AS j on j.FCRMVH_NROGUI = i.FCRMVH_NROGUI and j.FCRMVH_CODEMP = i.FCRMVH_CODEMP
--WHERE i.FCRMVH_NROGUI = NUMERO_GUIA and i.FCRMVH_CODEMP = EMPRESA_ID and id = 311